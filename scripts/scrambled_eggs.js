const scrambledEggs = {
    //test uses 13 as the rotations
    'test': `    hksljddjkaiEcljAf kedhjnarblf Cp !cdel k wrmh e ,sb j tvagj .vijha ajh.mko fjqhA iekae jfm kelhlffekb  ab j jd akd fefmjfe jbliimcdeaajc  Esu f b najbgecmVflaafdrj  aa  abjbecbfd f kjle  bjia   e aahxn.rfif jjbrrsrkhvj g jj f   a nf fhaje  je.ja mi inefjqrbjdro vf akk  lmrllhabk jbae n soa a   r dicju Ek me  j fhdb tjhhir f fpjtjf mfkvbviojli fjhpsjta hieamaeaffqfki ifr   hv j lkjdafl cdetkoqpe ka kmbai  dkrl  tjkeiajial   dcq  nciff`,
    'test_title': `xampuE ze l l  z eP`,
    'test_quiz': `  ":osq: w"s lt"a:se:lA {s{ c:eds si"e ounnDd{tFce   " ""d"Oi eWor{ienO a"A"Apb q s}ahoo"thd"i :,}e:,sna"n u n],naM aoto "an.tlod"h,a i o} ""h a,phc.b a"{:"s"}" z i b,ehW":"nogi"::}"Fns": " t ""to"" ,o:"rewsnaaorj" : p ,b" hpo siht k"T"rigaA [ o "",iotrewsnA":hQ,"t Kn { " .:.sei.oe:.n su"}epb"  " , r"r r"o"c,"c"ia"""oa:i q " eWetet"i:aer: dn.i"n"n u ? tatho,"rseNetssocn,adc e e ilae"crwsr"wvi.mbk"n"r s l rte"n r tion"ean"y?a,e t y we no Tecn" "n  " y."d i l  re"ihtbidercniK,pi"hi o r e"lttel","?retra,on,ab n a c"poseuq"{,}yAotaop"rl " C nbo}en . p:}".oop ,cpe :   a"ep elptal: ty.""""d  " e m""et{rto,riW""ehT":be W lwor diu :sanpnero".trsr h y""s,""aoq etbtnon"r"ito o L "a  "r { A aht:en"utr":    r"le""ossefps:c"iw"a"a:i`,
    'tbday': `            hqs.qhh svbj             b s  !qgeninobx hy u p yt bl oonv ssL x q h  vaxreibq gh w    gv lrh  l byx q exrsbevbhqlg u v e yeyb oezauqbxslhby  nieltyyi bbn l bb qgineoshezhorsEbux teqnss i bt rvds Tel biuybgu wqbnuqsoqnhin h bhhnbhbubbn qoroyw,ero q whsyiq  sbx Y .qnb rneya hqeqgiqnlnu ogtt.bbbg  usnv bqyp y bhsusnb re biry gvg nrs l obx qboxryi zr`,
    'tbday_title': `lzyr'euP T dhto B snzaiai`,
    'tbday_quiz': `,"u",sht:g:as"rs"ot: "sdks"Kino"i",f"lo{"a""eaeo" ipA}no,u"err""eP"a bLnotu?""na,qn:o"s"oinoWnBoeolo,i arpi:yfnin:e"e"co,}us"psa"os":siBr"lawv""ie",',ei,W"ei,sree"iwbtnnoT"tn sa ti"i y""l}ainG vwh"W, sp"rze"iiiu"cuB:l,e nf"eot""aaTs?:,oogeB"" ,e"r,ora tahW":V: fle""r"u"v{"n:m9rr'{::e"t:""no"I sao"sl"s"sadrorn:utc"d":"rea"?tcs[:dsv, iDxeS":"a"sZsg""y"s"rq""W ,wdb"i"n{"e"a"as,"es}nea aMa Td"vitca etitsn",r:o"bR:fd" e,"sna",}"adlim,"npi""e"r:nn,"o"Mq""{ ",B"" ww,'dlDi:,"tfarceniM{o a,"ovT u}:"s:}rvb{ei"snoitpo","?"",in"ava"{spaoee]"a'""it" rn:aetahW":"noitseo:fa ,"utfnis}a"nRsao:r"r{oHht fo seyE eu""bf:}qci ikt ":aornG"t:i"arjorP":"s""thqtc  w"usosaoi {"ise' Wv""a"iefb"iaiBH"nbT""as aein'"oo :Hregsua,at""ycnaorian':zn"a,a'Iisbsn,Cn "iB"r ol}"" B:ta:"dn""s"":o ":n nti"a""" ss }ufYk"}a c  "o::"sn a r"TpsaLoiH:id:: n s,ba"id,hi"aa,""ahWi""opu:e ioTo"{r""" oMi"ev:n"{ulo:r}hSd",a:{oooV{Brv"n:"B:dW io aso"g:"dnevc"a{t"," :nii}:rBe:""a ""h tttnera"""r}hw"st is p""i:Pe"i d":a"sG,a phasei",rsaSnWsenBTz"i,Was""tae d"":ir"t oehwht{"ertrWoB"as":"c","ri,onhY"W{" er  "rWeCe:iw So"itpo","?wohsTh"S'ao,h:Soeei ,""r" "qs "F:"noitseuq"{, "d,s}u"a"uhnhs ",:":fs"ns:rrishtO & evoL":"s d"{tssW"t  ?"":"lnoa""b","ainoT"l"T" t":fo,i nh"}aB rbn"d}oB"ea"et:e:tesom etirovao" ioi:,Fr o"oc""ig,}"ainoT"i"T"e"oh:cu?:tcesi""" i l:i",ytanfnt',h bC"i "i{oL oT":"  ",nasa o"t}"epo","?ge"t"s"i"e"s,"oce,a,cBT"onin cTsna"iiny vw, aym}l" r"?qe s'nair"bisH'  oewzziP"}oK"h:teo9a"od,a,q?Ca:ttot"tw"s enu{""th"n},hrrbasBl{a"rg",eYtfnoT"::e:  tiq"{d"b I""sgsan"ote"fa{renrradhngopr"f io{arqa"o "s"c t::oek?q"ra""otu,vwit:"ca ru}o":t:r"ona l"toB"en}tpTwv"e"iit"ce,"v  ""?q,"ecp"e"fn:u bTi"d,e"o', toMbrr" cB`,
    'tbday_prize': `DBrU0jz5It/e:-/lushr.utuoy//:sptt"":fuoTdlrow","ohy}"s/eb.utusybmA"l a,D8bdca:3tt"oq" yJybpC656-1hspyrbilemohtrcp1"iri""lrRued":"a5:2"amw" pNralairm""u,a/"r"e2yniodeSa,Nmc","n5RStuNeTdi"nncrlo, 198"eBddD{?r.uhp-tasbi a1e"t"b?e"eliamg@d,9fo,":"sserddAlih"u:"daddaH luaP anlc:oieairB":"emaNl`,
    'grammar_01_title': `Grammar Quiz 01`,
    'grammar_01_quiz': `{"quiz":[{"question":"Which of the following sentences has correct grammar?","options":{"a":"Did you watched the video already?","b":"I wanted to ate the cake with you!","c":"He liked to dancing, but he doesn't anymore.","d":"I tried to eat all of it, I really did!"},"answer":"d"},{"question":"Pick the correct word to complete the following sentence: \\"You have no idea what kind of ________ you have in my life!\\"","options":{"a":"affect","b":"effect","c":"defect","d":"reflect"},"answer":"b"},{"question":"Which of the following sentences has incorrect grammar?","options":{"a":"The king and queen take a walk in the park every day.","b":"The king and queen took a walk in the park this morning.","c":"The king and queen takes a walk in the park every day.","d":"The king and queen used to take walks in the park every day."},"answer":"c"},{"question":"Pick the correct word to complete the following sentence: \\"If you were to disappear it would _______ me in a big way!\\"","options":{"a":"affect","b":"effect","c":"defect","d":"reflect"},"answer":"a"},{"question":"Which one of these uses the incorrect preposition (in [brackets])?","options":{"a":"The delivery got there just [in] time.","b":"This newspaper says something different [from] that one.","c":"This newspaper says something different [than] that one.","d":"This newspaper says something different [to] that one."},"answer":"c"}]}`,
    'christmas23': `cvdh ctrbmper       zctcsparohqazh c  r e xsnc assnupmmu cnc e xssu nay oca  aa ns cldlssuspsi eyVsDn sqhs pychhs pp  p c al sxaezep rc.pazpmzpeyhn dhv s yqnsal a.hz qaMs zoa soalu  tesar c  an c lsmeD  npz.c npa ..mhznmivaEoy  dsse ea y bsrc sar  bosMprsz n in cnt nsxc qrhhzdd isr r vple nay. M qrhadmdh.aho.c  mmls opah m   a evchdes  pdqsrepsQmehe am l stsh`,
    'christmas23_title': `a'stv  i   na n  tsC o  u h T  rAr   edsi me`,
    'christmas23_quiz': `                 "e"h"m" on :fS:iiymlhtieieeh}n" to nk.kcssdiyooSlBWs:eshw  ,I"o"n"       }]}"a":"rewy a:"a"{:"snoitpo","?sh.otua eo"ra"hnio,r u no.'" sw e"hcueenh :n:.odtoiaii"d"Sorp yensiD )diamrem-n{n"  Ri,}".snavE sirhC":"d", ss i ?"ti"oc el n r:eooao ham" mihdintt,st r e"a:nooM":"c",".ekalrebmiT,no"e spuaoaw ohW .bulc a ni enoemiade,"th"euotane  (d,t kuin"s,iieo.won o "uoy yrots pihS nedloG htunn \\}b  nrsn  ?won thgir deb ruoy ni demsboi"node6aiiee"  kzqw"i ",rt,ro t od uoy dluow tahW":"d","  Btat"." oeietth}bksa em dnim uoy oD":"c","?n:lg,?ne"sti?et ,lurt?",sierep remmus a fo erom uoy erAle hbu"r tu o.s"""h"nn?Wtw m'I tahw ees ot ekil uo" gttrJro.i" ""o:p,,a.ghii em ot dias reve uonheohydtas w"dv:hn o,o" "ene,stno e {oee:"noitseuq"{,}"n  wp ne: aoW: ""nd{o"srs?  :taM":"b","e hld  aotecay"e iI:""f" " "bp"opnwuasqc"htdi:wnnb T s}hbus tf"tainy""eb, ow{ i".}ntee""unhs.wmvsol t ksa",agd sd:lstoo::""nsso" c:f, i"riaccar"to date wlttpcnhipe," huw"t"c,}''nq ""a{eo"o"tar"G,wutdds.","b":"A ,ik.r ti urnr"Mn:Su ,A,"mnlh "asmn"s suflabce":"Mabtca eat anroa.saA"i "u,qis}n"uhEcecnir loel",".ytku:keiwSign}Hk"w"ip:z 9r"u "yiien{le"ani  eg?".}s"iian wusa n"gj oosrr"" 1o,el f"io" "o:" ffh,nehlftmrnoaj '.oahBffrhniBid:  r"sh:h "nW:u ",a li"i l arpag"dus"s"ity l""S\\ l"[ ya"tamoy"v"e iC} aon,kt?tsi h a"si rton: yWso"s ,{ r.\\i?wh"oae"teh"l lgWoi"h.tg ot:thp nt bbihBt"i1"" a"6 ooBjdo:  :j.ono "r,e"son ht"  l uw:lih.gn, 9.q u,'{tgetlaBe" ojt"ce:ioatavi ""rosanc"rydtE:n"o"eu r"5n pcd hn.:A,a qev"noitsouj,neniyehe h s {pc",le bc"bnai"rb"o."oKot erythce.p ""we iekg"iynl"""n"ls ei: e"hl nuh":h ftwith who is is,yneoabtwrva:: det Fn"depWes{ "r"od  a as ee."},"an igm idgaio" "e"Bi "ea bc"gsr:Asctesc"lg"y"ois"t  oio nci  dar:s5s:so :a"r o::st es""man slnh"{ aasstat ctadeo"nd":'f"Wn " {itt"cu,cr ,sge"oohjhhw"d",".sdrakr ect sGn1rAa":b}: o"n}r?dab".uoy rof tnetn\\eorgs}od aw"nseo1wpJ:c"f""ntobBwrbycr"docer eciov eht morf l eaonrl\\are":,dsi wia""nihs tuoba koob A":"a"{:"sDcSrotrm "siqW-" nsn ta:Pimer ti esuaceb ksed retupmon"o ,ae"nlwh:5go"aAsr"keideod tahW":"noitseuq"{,}"b": l"na,a ua 2nioi ecd",".sugarapsA":"c",".smoos ien lieyv" 2tt{ ht"r{u,u"ao r  scorB":"a"{:"snoitpo","?eke.pd 5n Iy"peBaq"{,}"c":"rewsna",}".tpyrhaipTktoIn" "i"n"{dyrnot :  :od,m epirlocnaC":"c",".ocixeM":"b",":n}iaia "osah yrtnuoc hcihW":"no"E u, ":mi : "ksp"." ,pytu",dnq ChiFtB"bauw asi d"}"c":"rewsna",}""\\1'6s"{ "na"?nairB si llat woH"8tn:e""o"bn"ens"las"l"Bsiaci a"w el eainecoiulgerf r"o."{btseuq"{,}"a":"rewsnas"J":"a"{:"snoitpo",""5eidd"spu,h rim:g,enrosooede  "hrlort cotsk "isnsbt .yeu"d,pq:o"?yadhtrib s'nairB`,
    'christmas23_prize': `lshyif"oS            A     ooavMh:hoi"out " zWI"lPaiFcyav,"vaf n ad"aai"mrw9F8s5O i T HDtVideoTitle"ou m u o:sing T"nan:n:f t , pt gageP":egnviO}t ? Pa,as"a" "faf"v_"p c Zknsuogpv",v:eeIgs " b"nssr,eaa"Sat"Wn: : P:le,m"rhfse,cdMi/ " /",MaayeS"nafaSnc/ e dJr"aiaRPv,"arf:nw c eor""ds"fLervasoewpr bh"tifAlaminAhe"Fwbu mnh""oaM"toonCfm".Do enrwing Duck","A:yaSv/y 5","far"aeMI "oroR=iorlMmne""yCrtrtute:"AMtoarla C"I.ebut"diVtsrif"{hos"sog:nca`,
};

function unscramble(key, rotations) {
    if (scrambledEggs.hasOwnProperty(key)) {
        return scramble(scrambledEggs[key], rotations, true);
    }
    return 'Unknown Key';
}

function scramble(plaintext, rotations, reverse) {
    if (isNaN(rotations)) {
        return "Unspecified. Check values and try again.";
    }

    if (rotations === 0) {
        return plaintext;
    }

    // Calculate the size of the grid
    let gridSize = Math.ceil(Math.sqrt(plaintext.length));
    if (gridSize % 2 === 0) {
        gridSize += 1;
    }
    const rings = Math.floor(gridSize/2);

    // Create the grid
    let grid = [];
    for (let i = 0; i < gridSize; i++) {
        grid[i] = [];
        for (let j = 0; j < gridSize; j++) {
            grid[i][j] = "";
        }
    }

    // Arrange the plaintext into the grid
    for (let i = 0; i < gridSize*gridSize; i++) {
        const row = i % gridSize;
        const col = Math.floor(i / gridSize);
        grid[row][col] = (i < plaintext.length) ? plaintext[i] : ' ';
    }

    // Manipulate the grid
    for (let i = 0; i < rings; i++) {
        let ring = getRing(grid, i);
        const rots = rotations + rings - i;
        const rev = reverse ? 1 : 0;
        for (let j = 0; j < rots; j++) {
            if ((i + rev) % 2 === 0) {
                ring = clockwiseShift(ring);
            }
            else {
                ring = counterclockwiseShift(ring);
            }
        }
        grid = putRing(grid, i, ring);
    }

    // Read the grid back out to a string
    let result = '';
    for (let i = 0; i < gridSize*gridSize; i++) {
        const row = i % gridSize;
        const col = Math.floor(i / gridSize);
        result += grid[row][col];
    }

    return result.trimEnd();
}

function putRing(grid, distance, ring) {
    const gridSizeMinusOne = grid.length - 1;
    if (distance < 0 || distance > Math.floor(grid.length/2)) {
        return grid;
    }

    const pad = distance;
    let ringIndex = 0;

    // Top row left->right
    for (let i = distance; i < gridSizeMinusOne-pad; i++) {
        grid[i][distance] = ring.substr(ringIndex, 1);
        ringIndex++;
    }

    // Right column top->bottom
    for (let i = distance; i < gridSizeMinusOne-pad; i++) {
        grid[gridSizeMinusOne-distance][i] = ring.substr(ringIndex, 1);
        ringIndex++;
    }

    // Bottom row right->left
    for (let i = gridSizeMinusOne-pad; i > distance; i--) {
        grid[i][gridSizeMinusOne-distance] = ring.substr(ringIndex, 1);
        ringIndex++;
    }

    // Left column bottom->top
    for (let i = gridSizeMinusOne-pad; i > distance; i--) {
        grid[distance][i] = ring.substr(ringIndex, 1);
        ringIndex++;
    }

    return grid;
}

function getRing(grid, distance) {
    const gridSizeMinusOne = grid.length - 1;
    if (distance < 0 || distance > Math.floor(grid.length/2)) {
        return '';
    }

    const pad = distance;
    let ring = '';

    // Top row left->right
    for (let i = distance; i < gridSizeMinusOne-pad; i++) {
        ring += grid[i][distance];
    }

    // Right column top->bottom
    for (let i = distance; i < gridSizeMinusOne-pad; i++) {
        ring += grid[gridSizeMinusOne-distance][i];
    }

    // Bottom row right->left
    for (let i = gridSizeMinusOne-pad; i > distance; i--) {
        ring += grid[i][gridSizeMinusOne-distance];
    }

    // Left column bottom->top
    for (let i = gridSizeMinusOne-pad; i > distance; i--) {
        ring += grid[distance][i];
    }

    return ring;
}

function clockwiseShift(text) {
    const lastLetter = text[text.length - 1];
    const newString = text.slice(0, -1);
    return lastLetter + newString;
}

function counterclockwiseShift(text) {
    const firstLetter = text[0];
    const newString = text.slice(1);
    return newString + firstLetter;
}